{"version":3,"sources":["/examples/components/Play.jsx"],"names":[],"mappings":";;;;;AAAA,wDAA0B;AAC1B,kDAAiD;AACjD,uCAAuC;AACvC,wDAA0B;AAC1B,wFAA0C;AAC1C,oFAAoD;AACpD,6EAAqD;AAErD,IAAM,eAAe,GAAG,kNAOtB,CAAC;AAEH,IAAM,MAAM,GAAG;IACb,MAAM,EAAE,EAAE;IAEV,MAAM,EAAE,6EAGJ;IAEJ,MAAM,EAAE,2XAYJ;IAEJ,WAAW,EAAE,iWAaT;CACL,CAAC;AAEF;IAAwC,sCAAe;IAWrD,oBAAY,KAAK;QAAjB,YACE,kBAAM,KAAK,CAAC,SA+Cb;QA1DD,WAAK,GAAG,IAAI,CAAC;QACb,YAAM,GAAG,CAAC,CAAC;QACX,iBAAW,GAAG,EAAE,CAAC;QAWf,IAAM,MAAM,GAAG,KAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,IAAI,eAAe,EAAE,KAAK,CAAC,CAAC;QACtE,KAAI,CAAC,KAAK,GAAG;YACX,UAAU,EAAE,KAAK,CAAC,UAAU,IAAI,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,UAAU,GAAG,GAAG,CAAC;YACtE,MAAM,EAAE,MAAM;YACd,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;SAC5C,CAAC;QAEF,KAAI,CAAC,eAAe,GAAG,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACvD,KAAI,CAAC,eAAe,GAAG,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACvD,KAAI,CAAC,aAAa,GAAG,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACnD,KAAI,CAAC,kBAAkB,GAAG,KAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC7D,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QACjD,KAAI,CAAC,WAAW,GAAG;YACjB,KAAK,EAAE;gBACL,MAAM,EAAE,MAAM;aACf;SACF,CAAC;QACF,KAAI,CAAC,GAAG,GAAG;YACT,cAAc,EAAE,cAAO,CAAC;YACxB,OAAO,EAAE,gBAAM;gBACb,MAAM,sBACJ,QAAQ,EAAE,MAAM,IACb,MAAM,CACV,CAAC;gBAEF,IAAI,MAAM,CAAC,QAAQ,KAAK,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE;oBAC7C,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;oBAC1C,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,OAAO,IAAI,EAAE,CAAC;oBACtC,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,kBAAkB,CAAC;iBACrD;gBAED,OAAO,eAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,GAAG,EAAE,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YAC/D,CAAC;YACD,MAAM,EAAE,UAAC,IAAI,EAAE,GAAG;gBAChB,oBAAK,CAAC,IAAI,CAAC;oBACT,CAAC,CAAC,aAAK,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,IAAI,KAAK,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;oBACtD,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,CAAC;YAFvC,CAEuC;SAC1C,CAAC;QAEF,IAAM,KAAK,GAAG,EAAE,CAAC,KAAK;aACnB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;aAClD,GAAG,CAAC,cAAI,IAAI,WAAI,CAAC,SAAS,EAAd,CAAc,CAAC,CAAC;QAC/B,KAAI,CAAC,aAAa,GAAG,gCAA8B,KAAK,CAAC,IAAI,CAC3D,EAAE,CACH,2CAAwC,CAAC;;IAC5C,CAAC;IAED,8CAAyB,GAAzB,UAA0B,SAAS;QACjC,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;QAEzB,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,CAAC,IAAI,EAAE;YACjC,IAAM,MAAM,GAAG,IAAI,CAAC,WAAW,CAC7B,SAAS,CAAC,IAAI,IAAI,eAAe,EACjC,SAAS,CACV,CAAC;YACF,IAAI,CAAC,QAAQ,CAAC;gBACZ,MAAM,EAAE,MAAM;gBACd,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;aAC5C,CAAC,CAAC;SACJ;IACH,CAAC;IAED,sCAAiB,GAAjB;QACE,IAAI,CAAC,KAAK,CAAC,cAAc,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;IAC/D,CAAC;IAED,yCAAoB,GAApB;QACE,IAAI,CAAC,KAAK,CAAC,cAAc,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;IAChE,CAAC;IAED,gCAAW,GAAX,UAAY,aAAa,EAAE,KAAkB;QAAlB,gCAAQ,IAAI,CAAC,KAAK;QAC3C,IAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC;QAEnC,IAAI;YACF,IAAM,KAAK,GAAG,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC;YAEzC,IAAI,KAAK,IAAI,MAAM,CAAC,KAAK,CAAC,EAAE;gBAC1B,aAAa,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,OAAO,CACnC,oBAAoB,EACpB,aAAa,CACd,CAAC;aACH;YAED,aAAa,GAAG,6BAAiB,CAAC,aAAa,CAAC,CAAC,OAAO,CACtD,YAAY,EACZ,IAAI,CACL,CAAC,CAAC,OAAO;YAEV,OAAO,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;SAClC;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC,CAAC;SAC7D;QAED,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,kCAAa,GAAb,UAAc,OAAO,EAAE,KAAK;QAC1B,IAAI,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;YACrC,IAAM,KAAK,GAAG,KAAK;iBAChB,SAAS,CAAC,CAAC,EAAE,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;iBACrC,KAAK,CAAC,YAAY,CAAC,CAAC;YACvB,OAAO,GAAG,8FAAsB,KAAK,CAAC,MAAM,0BAC1C,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,MAAM,WAC7B,CAAC;SACL;QAED,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,kCAAa,GAAb;QACE,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;QAEjC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;YACzB,OAAO,cAAM,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;SACnD;QAED,OAAO,CACL,8BAAC,+BAAK,IACJ,KAAK,EAAC,MAAM,EACZ,MAAM,EAAC,MAAM,EACb,WAAW,EAAE,CAAC,EACd,cAAc,EAAE,IAAI,CAAC,aAAa,IAEjC,cAAM,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,CACrC,CACT,CAAC;IACJ,CAAC;IAED,iCAAY,GAAZ,UAAa,KAAK;QAChB,IAAI,CAAC,QAAQ,CAAC;YACZ,UAAU,EAAE,KAAK;SAClB,CAAC,CAAC;QAEH,IAAI;YACF,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAEjC,IAAI,CAAC,QAAQ,CAAC;gBACZ,MAAM;aACP,CAAC,CAAC;SACJ;QAAC,OAAO,CAAC,EAAE;YACV,QAAQ;SACT;IACH,CAAC;IAED,oCAAe,GAAf,UAAgB,CAAC;QACf,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC;QACxB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;QAExC,oCAAoC;QAEpC,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QACvD,MAAM,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAC3D,OAAO,KAAK,CAAC;IACf,CAAC;IAED,oCAAe,GAAf,UAAgB,CAAC;QACf,IAAM,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,OAAO,CAAC;QACrC,CAAC,CAAC,cAAc,EAAE,CAAC;QAEnB,IAAI,CAAC,QAAQ,CAAC;YACZ,UAAU,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC;SACjE,CAAC,CAAC;IACL,CAAC;IAED,kCAAa,GAAb;QACE,IAAI,CAAC,kBAAkB,EAAE,CAAC;IAC5B,CAAC;IAED,uCAAkB,GAAlB;QACE,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;QAC1D,MAAM,CAAC,mBAAmB,CAAC,WAAW,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAChE,CAAC;IAED,iCAAY,GAAZ;QACE,OAAO,CACL,8BAAC,gBAAU,IACT,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,EAC5B,QAAQ,EAAE,IAAI,CAAC,YAAY,EAC3B,QAAQ,EAAC,MAAM,GACf,CACH,CAAC;IACJ,CAAC;IAED,2BAAM,GAAN;QACS,kCAAQ,CAAe;QAC9B,IAAI,QAAQ,EAAE;YACZ,OAAO,CACL,uCAAK,SAAS,EAAC,MAAM;gBACnB,uCAAK,SAAS,EAAC,SAAS;oBACtB,uCAAK,SAAS,EAAC,cAAc;wBAC3B,uCAAK,SAAS,EAAC,gCAAgC,IAC5C,IAAI,CAAC,aAAa,EAAE,CACjB,CACF,CACF;gBACN,uCAAK,SAAS,EAAC,SAAS,EAAC,KAAK,EAAE,EAAC,MAAM,EAAE,GAAG,EAAC;oBAC3C,uCAAK,SAAS,EAAC,MAAM,IAAE,IAAI,CAAC,YAAY,EAAE,CAAO,CAC7C,CACF,CACP,CAAC;SACH;QAED,OAAO,CACL,uCACE,KAAK,EAAE;gBACL,QAAQ,EAAE,UAAU;gBACpB,GAAG,EAAE,EAAE;gBACP,MAAM,EAAE,CAAC;aACV;YAED,uCAAK,SAAS,EAAC,MAAM;gBACnB,uCAAK,SAAS,EAAC,aAAa;oBAC1B,uCAAK,SAAS,EAAC,gCAAgC,IAC5C,IAAI,CAAC,aAAa,EAAE,CACjB,CACF;gBACN,uCACE,SAAS,EAAC,uCAAuC,EACjD,KAAK,EAAE,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,EAAC;oBAErC,uCAAK,SAAS,EAAC,SAAS,EAAC,WAAW,EAAE,IAAI,CAAC,eAAe,GAAI;oBAC7D,IAAI,CAAC,YAAY,EAAE,CAChB,CACF,CACF,CACP,CAAC;IACJ,CAAC;IA1OM,uBAAY,GAAG;QACpB,SAAS,EAAE,KAAK;QAChB,QAAQ,EAAE,KAAK;KAChB,CAAC;IAwOJ,iBAAC;CAAA,CAjPuC,eAAK,CAAC,SAAS,GAiPtD;kBAjPoB,UAAU","file":"Play.js","sourcesContent":["import React from 'react';\nimport {toast} from '../../src/components/Toast';\nimport {render} from '../../src/index';\nimport axios from 'axios';\nimport Frame from 'react-frame-component';\nimport stripJsonComments from 'strip-json-comments';\nimport CodeEditor from '../../src/components/Editor';\n\nconst DEFAULT_CONTENT = `{\n    \"$schema\": \"https://houtai.baidu.com/v2/schemas/page.json#\",\n    \"type\": \"page\",\n    \"title\": \"Title\",\n    \"body\": \"Body\",\n    \"aside\": \"Aside\",\n    \"toolbar\": \"Toolbar\"\n}`;\n\nconst scopes = {\n  'none': ``,\n\n  'body': `{\n        \"type\": \"page\",\n        \"body\": SCHEMA_PLACEHOLDER\n    }`,\n\n  'form': `{\n        \"type\": \"page\",\n        \"body\": {\n            \"title\": \"\",\n            \"type\": \"form\",\n            \"autoFocus\": false,\n            \"api\": \"/api/mock/saveForm?waitSeconds=1\",\n            \"mode\": \"horizontal\",\n            \"controls\": SCHEMA_PLACEHOLDER,\n            \"submitText\": null,\n            \"actions\": []\n        }\n    }`,\n\n  'form-item': `{\n        \"type\": \"page\",\n        \"body\": {\n            \"title\": \"\",\n            \"type\": \"form\",\n            \"mode\": \"horizontal\",\n            \"autoFocus\": false,\n            \"controls\": [\n                SCHEMA_PLACEHOLDER\n            ],\n            \"submitText\": null,\n            \"actions\": []\n        }\n    }`\n};\n\nexport default class PlayGround extends React.Component {\n  state = null;\n  startX = 0;\n  oldContents = '';\n  frameTemplate;\n\n  static defaultProps = {\n    useIFrame: false,\n    vertical: false\n  };\n\n  constructor(props) {\n    super(props);\n\n    const schema = this.buildSchema(props.code || DEFAULT_CONTENT, props);\n    this.state = {\n      asideWidth: props.asideWidth || Math.max(300, window.innerWidth * 0.3),\n      schema: schema,\n      schemaCode: JSON.stringify(schema, null, 2)\n    };\n\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.removeWindowEvents = this.removeWindowEvents.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.schemaProps = {\n      style: {\n        height: '100%'\n      }\n    };\n    this.env = {\n      updateLocation: () => {},\n      fetcher: config => {\n        config = {\n          dataType: 'json',\n          ...config\n        };\n\n        if (config.dataType === 'json' && config.data) {\n          config.data = JSON.stringify(config.data);\n          config.headers = config.headers || {};\n          config.headers['Content-Type'] = 'application/json';\n        }\n\n        return axios[config.method](config.url, config.data, config);\n      },\n      notify: (type, msg) =>\n        toast[type]\n          ? toast[type](msg, type === 'error' ? '系统错误' : '系统消息')\n          : console.warn('[Notify]', type, msg)\n    };\n\n    const links = [].slice\n      .call(document.head.querySelectorAll('link,style'))\n      .map(item => item.outerHTML);\n    this.frameTemplate = `<!DOCTYPE html><html><head>${links.join(\n      ''\n    )}</head><body><div></div></body></html>`;\n  }\n\n  componentWillReceiveProps(nextprops) {\n    const props = this.props;\n\n    if (props.code !== nextprops.code) {\n      const schema = this.buildSchema(\n        nextprops.code || DEFAULT_CONTENT,\n        nextprops\n      );\n      this.setState({\n        schema: schema,\n        schemaCode: JSON.stringify(schema, null, 2)\n      });\n    }\n  }\n\n  componentDidMount() {\n    this.props.setAsideFolded && this.props.setAsideFolded(true);\n  }\n\n  componentWillUnmount() {\n    this.props.setAsideFolded && this.props.setAsideFolded(false);\n  }\n\n  buildSchema(schemaContent, props = this.props) {\n    const query = props.location.query;\n\n    try {\n      const scope = query.scope || props.scope;\n\n      if (scope && scopes[scope]) {\n        schemaContent = scopes[scope].replace(\n          'SCHEMA_PLACEHOLDER',\n          schemaContent\n        );\n      }\n\n      schemaContent = stripJsonComments(schemaContent).replace(\n        /('|\")raw:/g,\n        '$1'\n      ); // 去掉注释\n\n      return JSON.parse(schemaContent);\n    } catch (e) {\n      console.error(this.formatMessage(e.message, schemaContent));\n    }\n\n    return {};\n  }\n\n  formatMessage(message, input) {\n    if (/position\\s?(\\d+)$/.test(message)) {\n      const lines = input\n        .substring(0, parseInt(RegExp.$1, 10))\n        .split(/\\n|\\r\\n|\\r/);\n      message = `Json 语法错误，请检测。出错位置：${lines.length}，列：${\n        lines[lines.length - 1].length\n      }。`;\n    }\n\n    return message;\n  }\n\n  renderPreview() {\n    const schema = this.state.schema;\n\n    if (!this.props.useIFrame) {\n      return render(schema, this.schemaProps, this.env);\n    }\n\n    return (\n      <Frame\n        width=\"100%\"\n        height=\"100%\"\n        frameBorder={0}\n        initialContent={this.frameTemplate}\n      >\n        {render(schema, this.schemaProps, this.env)}\n      </Frame>\n    );\n  }\n\n  handleChange(value) {\n    this.setState({\n      schemaCode: value\n    });\n\n    try {\n      const schema = JSON.parse(value);\n\n      this.setState({\n        schema\n      });\n    } catch (e) {\n      //ignore\n    }\n  }\n\n  handleMouseDown(e) {\n    this.startX = e.clientX;\n    this.startWidth = this.state.asideWidth;\n\n    // this.startPosition.y = e.clientY;\n\n    window.addEventListener('mouseup', this.handleMouseUp);\n    window.addEventListener('mousemove', this.handleMouseMove);\n    return false;\n  }\n\n  handleMouseMove(e) {\n    const diff = this.startX - e.clientX;\n    e.preventDefault();\n\n    this.setState({\n      asideWidth: Math.min(800, Math.max(200, this.startWidth + diff))\n    });\n  }\n\n  handleMouseUp() {\n    this.removeWindowEvents();\n  }\n\n  removeWindowEvents() {\n    window.removeEventListener('mouseup', this.handleMouseUp);\n    window.removeEventListener('mousemove', this.handleMouseMove);\n  }\n\n  renderEditor() {\n    return (\n      <CodeEditor\n        value={this.state.schemaCode}\n        onChange={this.handleChange}\n        language=\"json\"\n      />\n    );\n  }\n\n  render() {\n    const {vertical} = this.props;\n    if (vertical) {\n      return (\n        <div className=\"vbox\">\n          <div className=\"row-row\">\n            <div className=\"cell pos-rlt\">\n              <div className=\"scroll-y h-full pos-abt w-full\">\n                {this.renderPreview()}\n              </div>\n            </div>\n          </div>\n          <div className=\"row-row\" style={{height: 200}}>\n            <div className=\"cell\">{this.renderEditor()}</div>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div\n        style={{\n          position: 'absolute',\n          top: 50,\n          bottom: 0\n        }}\n      >\n        <div className=\"hbox\">\n          <div className=\"col pos-rlt\">\n            <div className=\"scroll-y h-full pos-abt w-full\">\n              {this.renderPreview()}\n            </div>\n          </div>\n          <div\n            className=\"col bg-light lter b-l bg-auto pos-rlt\"\n            style={{width: this.state.asideWidth}}\n          >\n            <div className=\"resizer\" onMouseDown={this.handleMouseDown} />\n            {this.renderEditor()}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"]}