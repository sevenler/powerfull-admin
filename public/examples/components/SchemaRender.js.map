{"version":3,"sources":["/examples/components/SchemaRender.jsx"],"names":[],"mappings":"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","file":"SchemaRender.js","sourcesContent":["import React from 'react';\nimport {render} from '../../src/index';\nimport axios from 'axios';\nimport {toast} from '../../src/components/Toast';\nimport {alert, confirm} from '../../src/components/Alert';\nimport Button from '../../src/components/Button';\nimport LazyComponent from '../../src/components/LazyComponent';\nimport {default as DrawerContainer} from '../../src/components/Drawer';\nimport {Portal} from 'react-overlays';\nimport {withRouter} from 'react-router';\nfunction loadEditor() {\n  return new Promise(resolve =>\n    require(['../../src/components/Editor'], component =>\n      resolve(component.default))\n  );\n}\nexport default function(schema) {\n  if (!schema['$schema']) {\n    schema = {\n      $schema: 'https://houtai.baidu.com/v2/schemas/page.json',\n      ...schema\n    };\n  }\n\n  return withRouter(\n    class extends React.Component {\n      static displayName = 'SchemaRenderer';\n      state = {open: false};\n      toggleCode = () =>\n        this.setState({\n          open: !this.state.open\n        });\n      close = () =>\n        this.setState({\n          open: false\n        });\n      constructor(props) {\n        super(props);\n        const {router} = props;\n        const normalizeLink = to => {\n          to = to || '';\n          const location = router.getCurrentLocation();\n\n          if (to && to[0] === '#') {\n            to = location.pathname + location.search + to;\n          } else if (to && to[0] === '?') {\n            to = location.pathname + to;\n          }\n\n          const idx = to.indexOf('?');\n          const idx2 = to.indexOf('#');\n          let pathname = ~idx\n            ? to.substring(0, idx)\n            : ~idx2\n            ? to.substring(0, idx2)\n            : to;\n          let search = ~idx ? to.substring(idx, ~idx2 ? idx2 : undefined) : '';\n          let hash = ~idx2 ? to.substring(idx2) : location.hash;\n\n          if (!pathname) {\n            pathname = location.pathname;\n          } else if (pathname[0] != '/' && !/^https?:\\/\\//.test(pathname)) {\n            let relativeBase = location.pathname;\n            const paths = relativeBase.split('/');\n            paths.pop();\n            let m;\n            while ((m = /^\\.\\.?\\//.exec(pathname))) {\n              if (m[0] === '../') {\n                paths.pop();\n              }\n              pathname = pathname.substring(m[0].length);\n            }\n            pathname = paths.concat(pathname).join('/');\n          }\n\n          return pathname + search + hash;\n        };\n        this.env = {\n          updateLocation: (location, replace) => {\n            router[replace ? 'replace' : 'push'](normalizeLink(location));\n          },\n          isCurrentUrl: to => {\n            const link = normalizeLink(to);\n            return router.isActive(link);\n          },\n          jumpTo: to => {\n            to = normalizeLink(to);\n\n            if (/^https?:\\/\\//.test(to)) {\n              window.location.replace(to);\n            } else {\n              router.push(to);\n            }\n          },\n          fetcher: ({url, method, data, config, headers}) => {\n            config = config || {};\n            config.headers = headers || {};\n\n            if (data && data instanceof FormData) {\n              // config.headers = config.headers || {};\n              // config.headers['Content-Type'] = 'multipart/form-data';\n            } else if (\n              data &&\n              typeof data !== 'string' &&\n              !(data instanceof Blob) &&\n              !(data instanceof ArrayBuffer)\n            ) {\n              data = JSON.stringify(data);\n              config.headers['Content-Type'] = 'application/json';\n            }\n\n            if (method !== 'post' && method !== 'put' && method !== 'patch') {\n              if (data) {\n                if (method === 'delete') {\n                  config.data = data;\n                } else {\n                  config.params = data;\n                }\n              }\n\n              return axios[method](url, config);\n            }\n\n            return axios[method](url, data, config);\n          },\n          isCancel: value => axios.isCancel(value),\n          notify: (type, msg) =>\n            toast[type]\n              ? toast[type](msg, type === 'error' ? '系统错误' : '系统消息')\n              : console.warn('[Notify]', type, msg),\n          alert,\n          confirm,\n          copy: content => console.log('Copy', content)\n        };\n\n        this.handleEditorMount = this.handleEditorMount.bind(this);\n      }\n\n      handleEditorMount(editor, monaco) {\n        monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n          enableSchemaRequest: true,\n          validate: true\n        });\n      }\n\n      renderCode() {\n        return (\n          <LazyComponent\n            getComponent={loadEditor}\n            editorDidMount={this.handleEditorMount}\n            language=\"json\"\n            value={schema}\n            placeholder=\"加载中，请稍后。。。\"\n            disabled\n          />\n        );\n      }\n\n      renderSchema() {\n        const {router, location, theme} = this.props;\n\n        return render(\n          schema,\n          {\n            location,\n            theme\n          },\n          this.env\n        );\n      }\n\n      render() {\n        const ns = this.props.classPrefix;\n        const showCode = this.props.showCode;\n        return (\n          <div className=\"schema-wrapper\">\n            {showCode !== false ? (\n              <DrawerContainer\n                classPrefix={ns}\n                size=\"lg\"\n                onHide={this.close}\n                show={this.state.open}\n                position=\"left\"\n              >\n                {this.state.open ? this.renderCode() : null}\n              </DrawerContainer>\n            ) : null}\n            {this.renderSchema()}\n            {showCode !== false ? (\n              <Portal container={() => document.querySelector('.navbar-nav')}>\n                <Button\n                  classPrefix={ns}\n                  onClick={this.toggleCode}\n                  active={this.state.open}\n                  iconOnly\n                  tooltip=\"查看源码\"\n                  level=\"link\"\n                  placement=\"bottom\"\n                  className=\"view-code\"\n                >\n                  <i className=\"fa fa-code\" />\n                </Button>\n              </Portal>\n            ) : null}\n          </div>\n        );\n      }\n    }\n  );\n}\n"]}