{"version":3,"sources":["/examples/embed.tsx"],"names":[],"mappings":"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","file":"embed.js","sourcesContent":["import './polyfills/index';\nimport React from 'react';\nimport {render as renderReact} from 'react-dom';\nimport axios from 'axios';\nimport copy from 'copy-to-clipboard';\n\nimport qs from 'qs';\nimport {\n  toast,\n  alert,\n  confirm,\n  ToastComponent,\n  AlertComponent,\n  render as renderAmis\n} from '../src/index';\n\nexport function embed(\n  container: string | HTMLElement,\n  schema: any,\n  data: any,\n  env: any\n) {\n  if (typeof container === 'string') {\n    container = document.querySelector(container) as HTMLElement;\n  }\n  if (!container) {\n    console.error('选择器不对，页面上没有此元素');\n    return;\n  } else if (container.tagName === 'BODY') {\n    let div = document.createElement('div');\n    container.appendChild(div);\n    container = div;\n  }\n  container.classList.add('amis-scope');\n  let scoped: any;\n  const normalizeLink = (to: string) => {\n    to = to || '';\n    const location = window.location;\n\n    if (to && to[0] === '#') {\n      to = location.pathname + location.search + to;\n    } else if (to && to[0] === '?') {\n      to = location.pathname + to;\n    }\n\n    const idx = to.indexOf('?');\n    const idx2 = to.indexOf('#');\n    let pathname = ~idx\n      ? to.substring(0, idx)\n      : ~idx2\n      ? to.substring(0, idx2)\n      : to;\n    let search = ~idx ? to.substring(idx, ~idx2 ? idx2 : undefined) : '';\n    let hash = ~idx2 ? to.substring(idx2) : location.hash;\n\n    if (!pathname) {\n      pathname = location.pathname;\n    } else if (pathname[0] != '/' && !/^https?\\:\\/\\//.test(pathname)) {\n      let relativeBase = location.pathname;\n      const paths = relativeBase.split('/');\n      paths.pop();\n      let m;\n      while ((m = /^\\.\\.?\\//.exec(pathname))) {\n        if (m[0] === '../') {\n          paths.pop();\n        }\n        pathname = pathname.substring(m[0].length);\n      }\n      pathname = paths.concat(pathname).join('/');\n    }\n\n    return pathname + search + hash;\n  };\n\n  const responseAdpater = (api: any) => (value: any) => {\n    let response = value.data;\n    if (env && env.responseAdpater) {\n      const url = api.url;\n      const idx = api.url.indexOf('?');\n      const query = ~idx ? qs.parse(api.url.substring(idx)) : {};\n      const request = {\n        ...api,\n        query: query,\n        body: api.data\n      };\n      response = env.responseAdpater(api, response, query, request);\n    } else {\n      if (response.hasOwnProperty('errno')) {\n        response.status = response.errno;\n        response.msg = response.errmsg;\n      } else if (response.hasOwnProperty('no')) {\n        response.status = response.no;\n        response.msg = response.error;\n      }\n    }\n\n    const result = {\n      ...value,\n      data: response\n    };\n    return result;\n  };\n\n  renderReact(\n    <div className=\"amis-routes-wrapper\">\n      <ToastComponent\n        position={(env && env.toastPosition) || 'top-right'}\n        closeButton={false}\n        timeOut={5000}\n        extendedTimeOut={3000}\n      />\n      <AlertComponent container={container} />\n\n      {renderAmis(\n        schema,\n        {\n          ...data,\n          scopeRef: (ref: any) => (scoped = ref)\n        },\n        {\n          getModalContainer: () => document.querySelector('.amis-scope'),\n          notify: (type: string, msg: string) =>\n            toast[type]\n              ? toast[type](msg, type === 'error' ? '系统错误' : '系统消息')\n              : console.warn('[Notify]', type, msg),\n          alert,\n          confirm,\n          updateLocation: (to: any, replace: boolean) => {\n            if (to === 'goBack') {\n              return window.history.back();\n            }\n\n            replace || (location.href = normalizeLink(to));\n          },\n          isCurrentUrl: (to: string) => {\n            const link = normalizeLink(to);\n            const location = window.location;\n            let pathname = link;\n            let search = '';\n            const idx = link.indexOf('?');\n            if (~idx) {\n              pathname = link.substring(0, idx);\n              search = link.substring(idx);\n            }\n\n            if (search) {\n              if (pathname !== location.pathname || !location.search) {\n                return false;\n              }\n\n              const query = qs.parse(search.substring(1));\n              const currentQuery = qs.parse(location.search.substring(1));\n\n              return Object.keys(query).every(\n                key => query[key] === currentQuery[key]\n              );\n            } else if (pathname === location.pathname) {\n              return true;\n            }\n\n            return false;\n          },\n          jumpTo: (to: string, action?: any) => {\n            if (to === 'goBack') {\n              return window.history.back();\n            }\n\n            to = normalizeLink(to);\n\n            if (action && action.actionType === 'url') {\n              action.blank === false\n                ? (window.location.href = to)\n                : window.open(to);\n              return;\n            }\n\n            if (/^https?:\\/\\//.test(to)) {\n              window.location.replace(to);\n            } else {\n              location.href = to;\n            }\n          },\n          fetcher: (api: any) => {\n            let {url, method, data, responseType, config, headers} = api;\n            config = config || {};\n            config.withCredentials = true;\n            responseType && (config.responseType = responseType);\n\n            if (config.cancelExecutor) {\n              config.cancelToken = new (axios as any).CancelToken(\n                config.cancelExecutor\n              );\n            }\n\n            config.headers = headers || {};\n            config.method = method;\n\n            if (method === 'get' && data) {\n              config.params = data;\n            } else if (data && data instanceof FormData) {\n              // config.headers['Content-Type'] = 'multipart/form-data';\n            } else if (\n              data &&\n              typeof data !== 'string' &&\n              !(data instanceof Blob) &&\n              !(data instanceof ArrayBuffer)\n            ) {\n              data = JSON.stringify(data);\n              config.headers['Content-Type'] = 'application/json';\n            }\n\n            data && (config.data = data);\n            return axios(url, config).then(responseAdpater(api));\n          },\n          isCancel: (value: any) => (axios as any).isCancel(value),\n          copy: (contents: string, options: any = {}) => {\n            const ret = copy(contents, options);\n            ret && options.shutup !== true && toast.info('内容已拷贝到剪切板');\n            return ret;\n          },\n          richTextToken: '',\n          ...env\n        }\n      )}\n    </div>,\n    container\n  );\n  return scoped;\n}\n"]}