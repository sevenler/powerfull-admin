{"version":3,"sources":["/src/components/ContextMenu.tsx"],"names":[],"mappings":"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","file":"ContextMenu.js","sourcesContent":["import {ClassNamesFn, themeable} from '../theme';\nimport React from 'react';\nimport {render} from 'react-dom';\nimport {autobind} from '../utils/helper';\nimport Transition, {\n  ENTERED,\n  ENTERING,\n  EXITING\n} from 'react-transition-group/Transition';\nimport {Portal} from 'react-overlays';\nimport {calculatePosition} from '../utils/dom';\nconst fadeStyles: {\n  [propName: string]: string;\n} = {\n  [ENTERING]: 'in',\n  [ENTERED]: 'in',\n  [EXITING]: 'out'\n};\n\ninterface ContextMenuProps {\n  className?: string;\n  classPrefix: string;\n  classnames: ClassNamesFn;\n  container?: HTMLElement | null | (() => HTMLElement);\n}\n\nexport type MenuItem = {\n  label: string;\n  icon?: string;\n  disabled?: boolean;\n  children?: Array<MenuItem | MenuDivider>;\n  data?: any;\n  onSelect?: (data: any) => void;\n  onHighlight?: (isHiglight: boolean, data: any) => void;\n};\n\nexport type MenuDivider = '|';\n\ninterface ContextMenuState {\n  isOpened: boolean;\n  menus: Array<MenuItem | MenuDivider>;\n  x: number;\n  y: number;\n  align?: 'left' | 'right';\n}\n\nexport class ContextMenu extends React.Component<\n  ContextMenuProps,\n  ContextMenuState\n> {\n  static instance: any = null;\n  static getInstance() {\n    if (!ContextMenu.instance) {\n      const container = document.body;\n      const div = document.createElement('div');\n      container.appendChild(div);\n      render(<ThemedContextMenu />, div);\n    }\n\n    return ContextMenu.instance;\n  }\n\n  state: ContextMenuState = {\n    isOpened: false,\n    menus: [],\n    x: -99999,\n    y: -99999\n  };\n\n  menuRef: React.RefObject<HTMLDivElement> = React.createRef();\n  originInstance: this | null;\n  componentWillMount() {\n    this.originInstance = ContextMenu.instance;\n    ContextMenu.instance = this;\n  }\n\n  componentDidMount() {\n    // document.body.addEventListener('click', this.handleOutClick, true);\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    ContextMenu.instance = this.originInstance;\n    // document.body.removeEventListener('click', this.handleOutClick, true);\n    document.removeEventListener('keydown', this.handleKeyDown);\n    delete this.originInstance;\n  }\n\n  @autobind\n  openContextMenus(info: {x: number; y: number}, menus: Array<MenuItem>) {\n    this.setState({\n      isOpened: true,\n      x: info.x,\n      y: info.y,\n      menus: menus\n    });\n  }\n\n  @autobind\n  close() {\n    this.setState({\n      isOpened: false,\n      x: -99999,\n      y: -99999,\n      menus: []\n    });\n  }\n\n  // @autobind\n  // handleOutClick(e: Event) {\n  //   if (\n  //     !e.target ||\n  //     !this.menuRef.current ||\n  //     this.menuRef.current.contains(e.target as HTMLElement)\n  //   ) {\n  //     return;\n  //   }\n  //   if (this.state.isOpened) {\n  //     e.preventDefault();\n  //     this.close();\n  //   }\n  // }\n\n  handleClick(item: MenuItem) {\n    item.disabled ||\n      (Array.isArray(item.children) && item.children.length) ||\n      this.setState(\n        {\n          isOpened: false,\n          x: -99999,\n          y: -99999,\n          menus: []\n        },\n        () => (item.onSelect ? item.onSelect(item.data) : null)\n      );\n  }\n\n  @autobind\n  handleKeyDown(e: KeyboardEvent) {\n    if (e.keyCode === 27 && this.state.isOpened) {\n      e.preventDefault();\n      this.close();\n    }\n  }\n\n  handleMouseEnter(item: MenuItem) {\n    item.disabled || !item.onHighlight || item.onHighlight(true, item.data);\n  }\n\n  handleMouseLeave(item: MenuItem) {\n    item.disabled || !item.onHighlight || item.onHighlight(false, item.data);\n  }\n\n  @autobind\n  handleEnter(menu: HTMLElement) {\n    // 智能定位，选择一个合适的对齐方式。\n    const info = calculatePosition(\n      'auto',\n      menu.lastChild,\n      menu.children[1],\n      document.body\n    );\n\n    const align =\n      info.positionLeft + 300 < window.innerWidth ? 'right' : 'left';\n\n    this.setState({\n      x: info.positionLeft,\n      y: info.positionTop,\n      align\n    });\n  }\n\n  @autobind\n  handleOverlayContextMenu(e: React.MouseEvent) {\n    e.preventDefault();\n    this.close();\n  }\n\n  renderMenus(menus: Array<MenuItem | MenuDivider>) {\n    const {classnames: cx} = this.props;\n\n    return menus.map((item, index) => {\n      if (item === '|') {\n        return <li key={index} className={cx('ContextMenu-divider')} />;\n      }\n\n      const hasChildren = Array.isArray(item.children) && item.children.length;\n      return (\n        <li\n          key={`${item.label}-${index}`}\n          className={cx('ContextMenu-item', {\n            'has-child': hasChildren,\n            'is-disabled': item.disabled\n          })}\n        >\n          <a\n            onClick={this.handleClick.bind(this, item)}\n            onMouseEnter={this.handleMouseEnter.bind(this, item)}\n            onMouseLeave={this.handleMouseLeave.bind(this, item)}\n          >\n            {item.icon ? (\n              <span className={cx('ContextMenu-itemIcon', item.icon)} />\n            ) : null}\n            {item.label}\n          </a>\n          {hasChildren ? (\n            <ul className={cx('ContextMenu-subList')}>\n              {this.renderMenus(item.children!)}\n            </ul>\n          ) : null}\n        </li>\n      );\n    });\n  }\n\n  render() {\n    const {className, container, classnames: cx} = this.props;\n\n    return (\n      <Transition\n        mountOnEnter\n        unmountOnExit\n        onEnter={this.handleEnter}\n        in={this.state.isOpened}\n        timeout={500}\n      >\n        {(status: string) => (\n          <div\n            ref={this.menuRef}\n            role=\"contextmenu\"\n            className={cx(\n              'ContextMenu',\n              {\n                'ContextMenu--left': this.state.align === 'left'\n              },\n              className\n            )}\n          >\n            <div\n              onContextMenu={this.handleOverlayContextMenu}\n              onClick={this.close}\n              className={cx(`ContextMenu-overlay`, fadeStyles[status])}\n            />\n            <div\n              className={cx(`ContextMenu-cursor`)}\n              style={{left: `${this.state.x}px`, top: `${this.state.y}px`}}\n            />\n            <div\n              style={{left: `${this.state.x}px`, top: `${this.state.y}px`}}\n              className={cx(`ContextMenu-menu`, fadeStyles[status])}\n            >\n              <ul className={cx('ContextMenu-list')}>\n                {this.renderMenus(this.state.menus)}\n              </ul>\n            </div>\n          </div>\n        )}\n      </Transition>\n    );\n  }\n}\n\nexport const ThemedContextMenu = themeable(ContextMenu);\nexport default ThemedContextMenu;\n\nexport function openContextMenus(\n  info: Event | {x: number; y: number},\n  menus: Array<MenuItem | MenuDivider>\n) {\n  return ContextMenu.getInstance().openContextMenus(info, menus);\n}\n"]}