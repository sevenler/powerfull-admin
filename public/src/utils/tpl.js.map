{"version":3,"sources":["/src/utils/tpl.ts"],"names":[],"mappings":";;;;;AACA,6CAAsE;AACtE,2CAAwD;AAOxD,IAAM,QAAQ,GAEV,EAAE,CAAC;AAEP,SAAgB,kBAAkB,CAAC,IAAY,EAAE,OAAgB;IAC/D,QAAQ,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC;AAC3B,CAAC;AAFD,gDAEC;AAED,CAAC,sBAAe,EAAE,qBAAc,CAAC,CAAC,OAAO,CAAC,YAAE,IAAI,SAAE,EAAE,EAAJ,CAAI,CAAC,CAAC;AAEtD,SAAgB,MAAM,CACpB,GAAY,EACZ,IAAiB;IAAjB,gCAAiB;IACjB,cAAmB;SAAnB,UAAmB,EAAnB,qBAAmB,EAAnB,IAAmB;QAAnB,6BAAmB;;IAEnB,IAAI,CAAC,GAAG,IAAI,OAAO,GAAG,KAAK,QAAQ,EAAE;QACnC,OAAO,EAAE,CAAC;KACX;IAED,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IACjC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;QAC/C,IAAI,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAChC,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;YACrB,OAAO,OAAO,CAAC,OAAO,OAAf,OAAO,0BAAS,GAAG,EAAE,IAAI,GAAK,IAAI,GAAE;SAC5C;KACF;IAED,OAAO,GAAG,CAAC;AACb,CAAC;AAlBD,wBAkBC;AAED,SAAgB,cAAc,CAAC,UAAkB,EAAE,IAAa;IAC9D,IAAI,CAAC,UAAU,IAAI,OAAO,UAAU,KAAK,QAAQ,EAAE;QACjD,OAAO,KAAK,CAAC;KACd;IAED,sBAAsB;IACtB,IAAI;QACF,IAAI,KAAK,GAAG,KAAK,CAAC;QAClB,IAAM,GAAG,GAAG,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC3C,IAAI,CAAC,GAAG,EAAE;YACR,KAAK,GAAG,IAAI,CAAC;YACb,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;SACnD;QAED,IAAM,EAAE,GAAG,IAAI,QAAQ,CACrB,MAAM,EACN,OAAO,EACP,kBAAe,KAAK,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,mBAAa,UAAU,QAAK,CACpE,CAAC;QACF,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;QAClB,OAAO,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,wBAAU,EAAE,CAAC,CAAC;KAC1C;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChB,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAzBD,wCAyBC;AAED,SAAgB,MAAM,CAAC,EAAU,EAAE,IAAY;IAC7C,sBAAsB;IACtB,IAAI;QACF,IAAM,EAAE,GAAG,IAAI,QAAQ,CACrB,MAAM,EACN,OAAO,EACP,kBAAe,cAAc,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,IAAG,EAAE,OAAI,CACjE,CAAC;QACF,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;QAClB,OAAO,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,wBAAU,EAAE,CAAC,CAAC;KAC1C;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChB,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAdD,wBAcC","file":"tpl.js","sourcesContent":["import {createObject} from './helper';\nimport {register as registerBulitin, getFilters} from './tpl-builtin';\nimport {register as registerLodash} from './tpl-lodash';\n\nexport interface Enginer {\n  test: (tpl: string) => boolean;\n  compile: (tpl: string, data: object, ...rest: Array<any>) => string;\n}\n\nconst enginers: {\n  [propName: string]: Enginer;\n} = {};\n\nexport function reigsterTplEnginer(name: string, enginer: Enginer) {\n  enginers[name] = enginer;\n}\n\n[registerBulitin, registerLodash].forEach(fn => fn());\n\nexport function filter(\n  tpl?: string,\n  data: object = {},\n  ...rest: Array<any>\n): string {\n  if (!tpl || typeof tpl !== 'string') {\n    return '';\n  }\n\n  let keys = Object.keys(enginers);\n  for (let i = 0, len = keys.length; i < len; i++) {\n    let enginer = enginers[keys[i]];\n    if (enginer.test(tpl)) {\n      return enginer.compile(tpl, data, ...rest);\n    }\n  }\n\n  return tpl;\n}\n\nexport function evalExpression(expression: string, data?: object): boolean {\n  if (!expression || typeof expression !== 'string') {\n    return false;\n  }\n\n  /* jshint evil:true */\n  try {\n    let debug = false;\n    const idx = expression.indexOf('debugger');\n    if (~idx) {\n      debug = true;\n      expression = expression.replace(/debugger;?/, '');\n    }\n\n    const fn = new Function(\n      'data',\n      'utils',\n      `with(data) {${debug ? 'debugger;' : ''}return !!(${expression});}`\n    );\n    data = data || {};\n    return fn.call(data, data, getFilters());\n  } catch (e) {\n    console.warn(e);\n    return false;\n  }\n}\n\nexport function evalJS(js: string, data: object): any {\n  /* jshint evil:true */\n  try {\n    const fn = new Function(\n      'data',\n      'utils',\n      `with(data) {${/^\\s*return\\b/.test(js) ? '' : 'return '}${js};}`\n    );\n    data = data || {};\n    return fn.call(data, data, getFilters());\n  } catch (e) {\n    console.warn(e);\n    return null;\n  }\n}\n"]}